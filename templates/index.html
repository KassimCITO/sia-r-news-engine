{% extends "base.html" %}

{% block title %}Inicio - SIA-R News Engine{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-5 text-center">
        <div class="col-12">
            <h1 class="display-4"><i class="bi bi-robot"></i> SIA-R News Engine</h1>
            <p class="lead text-muted">Panel de Control y Monitorización de Tendencias en Tiempo Real</p>
        </div>
    </div>

    <!-- System Status & Config Overview -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-primary">
                <div class="card-header bg-primary text-white row mx-0 align-items-center">
                    <div class="col"><h5 class="mb-0"><i class="bi bi-cpu"></i> Estado del Sistema</h5></div>
                    <div class="col-auto"><span class="badge bg-light text-dark">{{ status.system }}</span></div>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Artículos Hoy
                            <span class="badge bg-primary rounded-pill">{{ status.articles_today }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Tasa de Éxito
                            <span class="badge bg-success rounded-pill">{{ (status.success_rate * 100)|round(1) }}%</span>
                        </li>
                    </ul>
                    <div class="mt-3 text-center">
                        <a href="/metrics" class="btn btn-outline-primary btn-sm">Ver Métricas Completas</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-wordpress"></i> Configuración WordPress</h5>
                </div>
                <div class="card-body">
                    <p class="mb-2"><strong>Sitio Web:</strong></p>
                    <p class="text-truncate">
                        {% if wp_site %}
                            <a href="{{ wp_site }}" target="_blank">{{ wp_site }}</a>
                        {% else %}
                            <span class="text-muted fst-italic">No configurado</span>
                        {% endif %}
                    </p>
                    <hr>
                    <p class="mb-2"><strong>Categorías Activas:</strong></p>
                    {% if wp_categories %}
                        <div class="d-flex flex-wrap gap-1">
                            {% for cat in wp_categories %}
                                <span class="badge bg-secondary">{{ cat }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted small">No hay categorías seleccionadas</p>
                    {% endif %}
                    <div class="mt-3 text-center">
                        <a href="/dashboard" class="btn btn-outline-info btn-sm">Configurar en Dashboard</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="bi bi-key"></i> Palabras Clave Activas</h5>
                </div>
                <div class="card-body">
                    <div class="p-2 bg-light rounded" style="max-height: 150px; overflow-y: auto;">
                        {% if keywords %}
                            {% for kw in keywords.split(',') %}
                                <span class="badge bg-dark me-1 mb-1">{{ kw.strip() }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">Ninguna palabra clave definida</span>
                        {% endif %}
                    </div>
                    <div class="mt-3 text-center">
                        <a href="/dashboard" class="btn btn-outline-warning btn-sm">Editar Keywords</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-5">
        <div class="col-12 text-center">
             <form action="/api/ui/run" method="post" id="pipelineForm" class="d-inline">
                 <!-- Hidden inputs would go here if we were submitting directly, but button links to dashboard runner usually. 
                      However, prompt asks for "Button to execute pipeline manually". 
                      Safest is to link to the runner page or call API. 
                      Linked to runner page for better UX as it requires title/content usually unless auto mode. -->
            </form>
            <a href="/pipeline/run" class="btn btn-lg btn-success shadow px-5 py-3">
                <i class="bi bi-play-circle-fill"></i> Ejecutar Pipeline Manualmente
            </a>
        </div>
    </div>

    <!-- Live Trends Ticker -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <h4 class="mb-0"><i class="bi bi-graph-up-arrow"></i> Tendencias en Tiempo Real</h4>
                    <span class="badge bg-danger animate-pulse">LIVE</span>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% if last_trends %}
                            {% for trend in last_trends %}
                                <a href="{{ trend.url }}" target="_blank" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1 fw-bold">{{ trend.title }}</h6>
                                        <small class="text-muted">{{ trend.source }} | {{ trend.timestamp }}</small>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">{{ trend.score }} pts</span>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-4 text-muted">
                                <i class="bi bi-hourglass-split"></i> Cargando tendencias o sin datos...
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="card-footer text-center bg-light">
                    <small class="text-muted">Actualizado automáticamente desde Google Trends, Twitter/X, NewsAPI</small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
